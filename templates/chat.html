<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>InsightPipe Chat</title>
  <link rel="stylesheet" href="/static/chat.css">
</head>
<body>



  <h2>Talk to Model</h2>
<form method="get" action="/chat">
  <label for="context">New System Prompt:</label>
  <input type="text" name="context" placeholder="e.g. You are an English Butler..." style="width: 100%;">
  <button type="submit">Start New Session</button>
</form>
<div class="active-context">
  <strong>Current System prompt:</strong> {{ session["system_prompt"] }}
</div>


  <form method="POST">
    <label for="model">Model:</label>
    {% if locked_model %}
      <span style="font-weight: bold">{{ locked_model }}</span>
      <input type="hidden" name="model" value="{{ locked_model }}">
    {% else %}
      <select name="model" id="model">
        {% for m in models %}
          <option value="{{ m }}">{{ m }}</option>
        {% endfor %}
      </select>
    {% endif %}

    <div class="block">
      <label for="prompt">Prompt:</label><br>
      <textarea name="prompt" rows="4" placeholder="Type your prompt here..."></textarea>
    </div>

    {% if prompt_history %}
      <div class="block">
        <label for="prior">Previous Prompts:</label>
        <select onchange="document.querySelector('textarea[name=prompt]').value=this.value;">
          <option value="">-- Select --</option>
          {% for p in prompt_history %}
            <option value="{{ p }}">{{ p }}</option>
          {% endfor %}
        </select>
      </div>
    {% endif %}

    <button type="submit">Send</button>
  </form>

{% if result %}
  <div class="response">
    <h3>Latest Response:</h3>
    {{ result.response | markdown | safe }}
  </div>

  <div class="history">
    <h4>Conversation History:</h4>
    {% for m in result.history %}
      <div class="{{ 'user-message' if m.role == 'user' else 'agent-message' }}">
        <strong>{{ m.role | capitalize }}:</strong>
        {{ m.content | markdown | safe }}
      </div>
    {% endfor %}
  </div>
{% endif %}


</body>
</html>
